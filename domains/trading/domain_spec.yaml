domain_name: trading
display_name: Trading & Finance AI Evaluation
description: Evaluation suite for trading algorithms, RL agents, and financial decision support systems
risk_level: critical
regulatory_frameworks:
  - FINRA_Rule_3110
  - SEC_Regulation_SHO
  - Reg_T_Margin
  - MiFID_II

entities:
  position: [symbol, quantity, entry_price, current_price, pnl]
  order: [order_type, symbol, quantity, limit_price, stop_price]
  account: [account_id, balance, buying_power, margin_used]
  market_data: [symbol, price, volume, bid, ask, timestamp]
  risk_metric: [var, sharpe, drawdown, beta, volatility]

safety_constraints:
  - name: position_size_limit
    description: Ensure position sizes are within risk limits
    constraint_type: range_check
    parameters:
      max_position_pct: 10.0
      max_portfolio_concentration: 25.0
    severity: critical

  - name: margin_requirement_check
    description: Validate Regulation T margin requirements
    constraint_type: margin_check
    parameters:
      min_margin_ratio: 0.25
      initial_margin_requirement: 0.5
    severity: critical

  - name: pattern_day_trader_check
    description: Detect and prevent pattern day trader violations
    constraint_type: trading_pattern_check
    parameters:
      max_day_trades_per_5_days: 3
      min_account_balance: 25000
    severity: high

  - name: short_sale_regulation
    description: Validate short sale compliance (Reg SHO)
    constraint_type: short_sale_check
    parameters:
      locate_required: true
      uptick_rule: false
    severity: high

  - name: risk_limit_validator
    description: Ensure trades don't exceed daily/weekly risk limits
    constraint_type: risk_check
    parameters:
      max_daily_loss_pct: 2.0
      max_weekly_loss_pct: 5.0
      max_var_95: 10000
    severity: critical

knowledge_bases:
  - name: sec_edgar
    type: rest_api
    api_url: https://data.sec.gov/
    cache_ttl: 3600
    config:
      rate_limit: 10_per_second

  - name: finra_api
    type: rest_api
    api_url: https://api.finra.org/
    cache_ttl: 86400

  - name: market_data_feed
    type: rest_api
    api_url: https://api.polygon.io/
    cache_ttl: 60
    config:
      realtime: true

  - name: reference_data
    type: database
    config:
      symbols: equity_reference_table
      corporate_actions: dividend_splits_table

success_metrics:
  primary: risk_adjusted_return_sharpe
  secondary:
    - total_return
    - max_drawdown
    - win_rate
    - profit_factor
    - calmar_ratio
  rl_specific:
    - cumulative_reward
    - episode_pnl
    - trades_per_episode
    - risk_violations
    - exploration_efficiency

simulators:
  - name: market_simulator
    simulator_type: rl_environment
    dynamics: stochastic
    state_space:
      portfolio: [positions, cash, margin_used]
      market: [prices, volumes, order_book_depth]
      indicators: [rsi, macd, bollinger_bands, moving_averages]
      risk_metrics: [portfolio_var, beta, correlation_matrix]
    action_space:
      place_order: [symbol, order_type, quantity, price]
      cancel_order: [order_id]
      close_position: [symbol, quantity]
      do_nothing: boolean
    reward_function: risk_adjusted_pnl_with_constraints
    transitions: learned_from_historical_market_data
    config:
      use_real_order_book: true
      slippage_model: volume_based
      commission_per_share: 0.005
      market_impact: true

tier1_modules:
  - PositionSizeLimitValidator
  - MarginRequirementChecker
  - PatternDayTraderDetector
  - RiskLimitValidator
  - ShortSaleComplianceChecker
  - OrderValidityChecker
  - PriceReasonabilityChecker

tier2_models:
  - name: RiskClassifier
    model_type: bert_classifier
    input_features:
      - position_sizes
      - portfolio_concentration
      - current_drawdown
      - volatility_regime
      - correlation_stress
      - tier1_violations
    output: risk_score_0_to_1
    training_data_source: historical_risk_events

  - name: MarketRegimeDetector
    model_type: regime_classifier
    input_features:
      - volatility_percentile
      - volume_profile
      - correlation_structure
      - trend_strength
    output: regime_label
    config:
      regimes: [low_vol, high_vol, trending, mean_reverting, crisis]

tier3_evals:
  - name: TradingStrategyEvaluator
    eval_type: strategy_quality
    criteria:
      - risk_management
      - regulatory_compliance
      - execution_quality
      - diversification
      - position_sizing
    prompt_template: trading_strategy_eval_v1

  - name: PortfolioConstructionEvaluator
    eval_type: portfolio_quality
    criteria:
      - risk_adjusted_return
      - correlation_structure
      - tail_risk_management
      - rebalancing_logic
    prompt_template: portfolio_eval_v1

transfer_metrics:
  - sim_sharpe_to_real_sharpe_correlation
  - drawdown_prediction_accuracy
  - regime_change_detection_rate
  - execution_quality_transfer

config:
  pii_detection_enabled: true
  regulatory_audit_required: true
  real_time_monitoring: true
  expert_review_threshold: 0.9
  min_backtest_period_days: 252
  min_confidence_for_live_trading: 0.98
